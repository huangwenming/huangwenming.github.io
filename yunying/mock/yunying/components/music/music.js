define("components/music/music",function(s,i,e){var t=function(s){this._events={},this.src=s.src,this.name=s.name||"",this.isLoop=s.isLoop||"loop",this.isAutoPlay=!0,this.gaplessBuffer=s.gaplessBuffer||1.2,this.musicCallbacks=s.musicCallbacks,this.init()};t.prototype.init=function(){this.render(),this.bindEvent()},t.prototype.render=function(){var s=this.musicIcon=document.createElement("div");s.className="music";var i='<div class="music-name"><p>'+this.name+"</p></div>";s.innerHTML=i,document.body.appendChild(s);var e=this.musicMedia=document.createElement("audio");e.style.cssText="display:none; height: 0",e.src=this.src,e.loop=this.isLoop,e.preload="auto"},t.prototype.play=function(s){s&&this.musicMedia.paused&&"music"===this.musicIcon.className&&this.musicMedia.play(),s||this.musicMedia.paused||this.musicMedia.pause()},t.prototype.bindEvent=function(){function s(){e.play(!0),document.body.removeEventListener("touchstart",s)}function i(){e.play(!0),document.addEventListener("WeixinJSBridgeReady",function(){e.play(!0)},!1),document.removeEventListener("DOMContentLoaded",i)}var e=this;this._events.musicLoopHandler=function(){var s=this.gaplessBuffer;this.currentTime>this.duration-s&&(this.currentTime=0,this.play())},this._events.musicIconHandler=function(s){var i=e.musicIcon.className;"music"===i?(e.musicIcon.className="music music-disable",e.musicMedia.paused||(e.musicMedia.pause(),e.musicCallbacks&&e.musicCallbacks.onClose&&e.musicCallbacks.onClose())):(e.musicIcon.className="music",e.musicMedia.paused&&(e.musicMedia.play(),e.musicCallbacks&&e.musicCallbacks.onOpen&&e.musicCallbacks.onOpen())),s.stopPropagation()},this.isAutoPlay&&(document.body.addEventListener("touchstart",s),document.addEventListener("DOMContentLoaded",i)),"loop"===this.isLoop&&this.musicMedia.addEventListener("timeupdate",this._events.musicLoopHandler),this.musicIcon.addEventListener("touchstart",this._events.musicIconHandler)},t.prototype.unbindEvent=function(){},e.exports=t});